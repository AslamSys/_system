version: '3.8'

services:
  speaker-verification:
    build: .
    container_name: speaker-verification
    restart: unless-stopped
    
    volumes:
      # Configurações (editáveis externamente)
      - ./config:/app/config:ro
      
      # Embeddings persistentes (não perde ao recriar container)
      - ./data/embeddings:/app/data/embeddings
      
      # Amostras de áudio (opcional, para backup)
      - ./data/samples:/app/data/samples
    
    environment:
      - TZ=America/Sao_Paulo
      - PYTHONUNBUFFERED=1
    
    networks:
      - mordomo-network
    
    depends_on:
      - nats
    
    # Healthcheck (opcional)
    healthcheck:
      test: ["CMD", "python", "-c", "import os; exit(0 if os.path.exists('/app/data/embeddings') else 1)"]
      interval: 30s
      timeout: 10s
      retries: 3

networks:
  mordomo-network:
    external: true
